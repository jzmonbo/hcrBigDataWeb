<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>账号设置-数据猿</title>
<meta name="Keywords" content="账号设置-数据猿"/>
<meta name="Description" content='账号设置-数据猿' />
<meta content="width=device-width, initial-scale=1,user-scalable=yes" name="viewport" />
<meta content="Title" name="apple-mobile-web-app-title" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta content="True" name="HandheldFriendly" />
<meta content="320" name="MobileOptimized" />
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-status-bar-style" content="black" />

<link rel="shortcut icon" href="/favicon.ico"/>
<link  rel="Bookmark"  href="favicon.ico"> 
<link href="/${res}/css/styleComm.css" rel="stylesheet" type="text/css" />
<!-- <link href="/${res}/css/html5.css" rel="stylesheet" type="text/css"/> -->

<link href="${resSys}/front.css" rel="stylesheet" type="text/css"/>
<link href="${resSys}/jqueryUI/jquery.ui.css" rel="stylesheet" type="text/css"/>
<script src="${resSys}/jquery.js" type="text/javascript"></script>
<script src="${resSys}/jqueryUI/jquery-ui.js" type="text/javascript"></script>
<script src="${resSys}/front.js" type="text/javascript"></script>
<script src="${resSys}/tongji.js" type="text/javascript"></script>
<script src="${resSys}/ckplayer/ckplayer.js" type="text/javascript"></script>
<link href="/${res}/css/generate.css" rel="stylesheet" type="text/css" />
<script src="${resSys}/generate.js" type="text/javascript"></script>
<script type="text/javascript">
$(function(){
	$.ajaxSetup ({
	    cache: false //关闭AJAX相应的缓存
	}); 
	
    $('a').bind('focus', function(){
        this.blur();
    });
});
</script>
<script type="text/javascript">
	var totalPage = 0;			//总页数
	var perPage = 10;			//每页条数
	var currentPage = 0;		//当前条数
	var linshiPage = 1;			//初使化临时当前条数
	
	function loadMore(){
		lis = $(".message-con").children("ul");
		totalPage = lis.size();
		currentPage = linshiPage * 10 - 1;
		for (var i=0;i<perPage+1;i++){
			currentPage++;
			if (currentPage<=totalPage){
				lis.children("li").get(i).css("display","block");
			}else if (currentPage>totalPage){
				break;
			}
		}
		linshiPage++;
		if (currentPage>totalPage){
			$('.morediv').remove();
		}
	}
</script>
<link rel="canonical" href="http://www.datayuan.cn/"/>
<script type="text/javascript">
	$(function(){
		var imgs1 = $(".wz-div-img img");
		var imgs2 = $("#divcontent p");
		var flagFirst = false;
		if (imgs1.length > 0){
			var count = 0;
			imgs1.each(function(){
				var theImage = new Image();
				theImage.src = $(this).attr("src");
				var imageWidth = theImage.width;
				var imageHeight = theImage.height;
				if (imageWidth >= 300 && imageHeight >= 300){
					$("#wx_pic").children("img").attr("src",theImage.src);
					count = count + 1;
					flagFirst = true;
					return false;
				}
			});
			if (count == 0){
				$("#wx_pic").children("img").attr("src","/${res}/images/d.png");
			}
		}else{
			$("#wx_pic").children("img").attr("src","/${res}/images/d.png");
		}
		if (!flagFirst){
			if (imgs2.length > 0){
				var count = 0;
				imgs2.each(function(){
					var txtImg = $(this).children("img");
					if (txtImg.length > 0){
						var theImage = new Image();
						theImage.src = txtImg.attr("src");
						var imageWidth = theImage.width;
						var imageHeight = theImage.height;
						if (imageWidth >= 300 && imageHeight >= 300){
							$("#wx_pic").children("img").attr("src",theImage.src);
							count = count + 1;
							return false;
						}
					}
				});
				if (count == 0){
					$("#wx_pic").children("img").attr("src","/${res}/images/d.png");
				}
			}else{
				$("#wx_pic").children("img").attr("src","/${res}/images/d.png");
			}
		}
	});
	
	function readMessage(rmid,lia){
		$.ajax(
			url : '${base}/member/read_message.jspx',
			data : {
				rmid : rmid,
			},
			type:'post',  
		    cache:false,
		    success : function(data){
		    	if (data == 1){			//消息已读
		    		$(lia).parent().children("img").attr("src","${base}/r/cms/www/default/images/open_letter.gif");	
		    	}
		    }
		);
	}
	
	function showMessageContent(lia){
		$(lia).siblings("div").css("display","block");
	}
	
	function hiddenMessageContent(lia){
		$(lia).siblings("div").css("display","none");
	}
</script>
<!-- 
<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
 -->
</head>

<body>
	[#include "../include/login.html"]
	<div id='wx_pic' style='margin:0 auto;display:none;'>
		<img src='/${res}/images/shujuyuan.jpg' />
	</div>
	<!---头部开始--->
	[#include "../include/header.html"/]
    <!---头部结束--->
    
    <!---页面内容（文章）开始--->
    <div class="mainbody-div">       
    	<!---个人中心页添加的我的收藏、我的消息、账号设置菜单栏开始--->
        <div class="gr-zx-nav">
        	<div class="gr-zx-tx">
            	<img src="images/img-l.jpg" />
            </div>
        	<ul>
            	<li><a href="${base}/member/index.jspx">我的收藏</a></li>
                <li><a href="${base}/member/message_center.jspx" class="this-a">我的消息</a></li>
                <li><a href="${base}/member/account.jspx">账号设置</a></li>
            </ul>
        </div> 
        <!---个人中心页添加的我的收藏、我的消息、账号设置菜单栏结束--->
        
    	<!---左边内容部分开始--->
        <div class="main-div-l message-div">
        	<div class="sousuo-tit">
            	<h2 class="zh-sz-a"><a href="#" onclick="switchAccount(this,0);return false;" class="thisa">数据猿账号</a><a href="#" onclick="switchAccount(this,1);return false;">第三方关联账号</a></h2>
            </div>
            <div class="message-con">
            	<!--数据猿账号-->
            	<div class="data-y-zh">
                	<div class="tx-div">
                    	<dl>
                        	<dt><img src="${user.userImg}" /></dt>
                            <dd>
                            	<a href="#" onclick="updateHImg();return false;">修改头像</a>
                            	<div id="updateHeadImg" style="display:none;">
							         <img id="preImg1" alt="预览" style="width:100px;height:70px;background-color:#ccc;border:1px solid #333" src="${user.userImg!}"/>
							         <span id="ufc1" style="position:relative">
								        <input type='text' id='uploadFileText1' size="14"/>  
										<input class="member_button" type='button' value='浏览...'/>
										<input onchange="$('#uploadFileText1').val(this.value)" size="14" type="file" id="uploadFile1" style="height:24px;opacity:0;filter:alpha(opacity=0);position:absolute;right:5px;top:-5px; *top:50px; *left:10; _left:0px;"/>
							         </span> <input type="button" value="上传" onclick="upload(1);freshPageImg();" class="member_button"/>
									<span style="display: none;">宽: <input type="text" id="zoomWidth1" value="${(site.config.memberConfig.userImgWidth)!}" size="5"/>
										高: <input type="text" id="zoomHeight1" value="${(site.config.memberConfig.userImgHeight)!}" size="5"/>
									</span> 
									<input type="button" value="剪裁" onclick="imgCut(1);" class="member_button"/> 
									 <input type="button" value="预览" onclick="previewImg(1);" class="member_button"/><br/>
									<input id="uploadImgPath1" name="userImg" style="width:220px" value="${user.userImg!}" type="hidden"/>
                            	</div>
                            </dd>
                        </dl>
                    </div>
                    <div class="">
                    	<table class="table-in" cellpadding="0" cellspacing="0">
                        	<tr>
                            	<td>用户账号：<input type="hidden" name="mail" value="${user.mail}" /></td>
                                <td></td>
                            </tr>
                        	<tr>
                            	<td>用户昵称：</td>
                                <td><input type="text" name="username" /></td>
                            </tr>
                            <tr>
                            	<td>用户密码：</td>
                                <td><input type="password" name="newPwd" /></td>
                            </tr>
                            <tr>
                            	<td></td>
                                <td><input type="button" onclick="updatePwd()" value="确认修改" class="btn" /></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                
                <!--第三方关联账号-->
                <div class="gl-zh-div" style="display:none;">
                	<table cellpadding="0" cellspacing="0" class="gl-tab">
                		[#if user.ext.weixin??]
                			<tr>
	                        	<td><img src="images/wx.png" /></td>
	                            <td><span class="this-span">已授权</span></td>
	                            <td><span class="this-span">账号：${user.ext.weixin}</span></td>
	                            <td><a href="#" class="this-a-sq">取消授权</a></td>
	                        </tr>
	                    [#else]
	                    	<tr>
	                        	<td><img src="images/wx.png" /></td>
	                            <td><span class="this-span">未授权</span></td>
	                            <td><span class="this-span">账号：${user.ext.weixin}</span></td>
	                            <td><a href="#">获取授权</a></td>
	                        </tr>
                		[/#if]
                    	[#if user.ext.qq??]
                    		<tr>
	                        	<td><img src="images/wb.png" /></td>
	                            <td><span>已授权</span></td>
		                        <td>账号：${user.ext.qq}</td>
		                        <td><a href="#" class="this-a-sq">取消授权</a></td>
	                        </tr>
	                    [#else]
	                    	<tr>
	                        	<td><img src="images/wb.png" /></td>
	                            <td><span>未授权</span></td>
		                        <td>账号：${user.ext.qq}</td>
		                        <td><a href="#">获取授权</a></td>
	                        </tr>
                    	[/#if]
                        [#if user.ext.sina??]
                        	<tr>
	                        	<td><img src="images/qq.png" /></td>
	                            <td><span>已授权</span></td>
	                            <td>账号：${user.ext.sina}</td>
	                            <td><a href="#" class="this-a-sq">取消授权</a></td>
	                        </tr>
                        [#else]
                        	<tr>
	                        	<td><img src="images/qq.png" /></td>
	                            <td><span>未授权</span></td>
	                            <td>账号：${user.ext.sina}</td>
	                            <td><a href="#">获取授权</a></td>
	                        </tr>
                        [/#if]
                    </table>
                </div>
                
            </div>
        </div>
        <!---左边内容部分开始--->
    </div>
    <!---页面内容（文章）结束--->
    
    
    <!---底部版权部分开始--->
    <div style="float:right;">
    	<a href="#" title="返回顶部" id="goto-top"></a>
    	<img id="goto-top2" src="${base}/r/cms/www/default/images/qrCodeSmall.jpg" onMouseOver="this.src='${base}/r/cms/www/default/images/qrCodeBig.jpg'" onMouseOut="this.src='${base}/r/cms/www/default/images/qrCodeSmall.jpg'" />
    </div>
    
    <div class="footer">
    	<div class="footercon">
		    [#include "../include/hotSpotNavigation.html"]
		    [#include "../include/footer.html"/]
	    </div>
    </div>
    <!---底部版权部分结束--->
    
</body>
</html>
<script type="text/javascript">
	//切换帐户
	function switchAccount(lia,num){
		$(lia).addClass("thisa");
		$(lia).siblings("a").removeClass("thisa");
		if (num == 0){					//数据猿帐户
			$(".data-y-zh").css("display","block");
			$(".gl-zh-div").css("display","none");
		}else if (num == 1){			//第三方帐户
			$(".data-y-zh").css("display","none");
			$(".gl-zh-div").css("display","block");
		}
	}
	
	//修改头像
	function updateHImg(){
		$("#updateHeadImg").css("display","block");
	}
	
	//刷新页面头像和修改用户头像路径
	function freshPageImg(){
		var hpath = $("input[name=userImg]");
		if (hpath.length > 0){
			$.ajax(
				url:'${base}/member/switchHeadImg.jspx',
			     data:{  
			    	 userImg : hpath.val()
			     },  
			     type:'post',  
			     cache:false,  
			     dataType:'json',  
			     success:function(data) {
			    	 if (data == 1){
			    		 hpath.parent().parent().siblings("dt").children("img").attr("src",hpath.val());
			    	 }
			     }		
			);
		}
	}
	
	//修改用户昵称和密码
	function updatePwd(){
		var mail = $("input[name=mail]").val();
		var username = $("input[name=username]").val();
		var newPwd = $("input[name=newPwd]").val();
		$.ajax(
			url:'${base}/member/unamePwd.jspx',
		     data:{  
		    	 mail : mail,
		    	 username : username,
		    	 newPwd : newPwd
		     },  
		     type:'post',  
		     cache:false,  
		     dataType:'json',  
		     success:function(data) {
		    	 if (data == 1){
		    		 alert("修改成功！");
		    	 }
		     }		
		);
	}
</script>